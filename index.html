<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AniWatch - Главная страница</title>
    <link rel="stylesheet" href="static/css/index.css">
</head>
<body>
<div class="container">
    <header>
        <h1 class="logo">AniWatch</h1>
        <p class="tagline">Лучшие аниме сериалы в одном месте</p>
    </header>

    <div class="search-container">
        <input type="text" class="search-input" id="searchInput"
               placeholder="Введите название аниме...">
        <button class="search-btn" id="searchBtn">Поиск</button>
    </div>

    <main>
        <div class="anime-grid" id="animeGrid">
            <!-- Сюда прилетят карточки -->
        </div>
    </main>

    <!-- Кнопка Telegram -->
    <div class="telegram-container">
        <button class="telegram-btn" id="telegramBtn">
            <svg class="telegram-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.509l-3-2.21-1.447 1.394c-.140.140-.260.260-.534.260l.213-3.05 5.56-5.022c.240-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.640-.203-.652-.64.136-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
            </svg>
            Наш Telegram канал
        </button>
    </div>

    <footer>
        © 2025 AniWatch - Все права защищены
    </footer>
</div>

<script>
    const API_URL = "https://aniwatch-backend-production.up.railway.app/api/v1/anime";
    const API_KEY = "poopgaymaster";

    let animeList = [];

    // Загрузка аниме с сервера
    async function loadAnime() {
        try {
            const res = await fetch(API_URL, {
                method: "GET",
                headers: {
                    "X-API-KEY": API_KEY
                }
            });

            if (!res.ok) {
                throw new Error("Ошибка загрузки API: " + res.status);
            }

            animeList = await res.json();
            createAnimeCards();
        } catch (error) {
            console.error(error);
            document.getElementById("animeGrid").innerHTML =
                '<div class="no-results">Ошибка загрузки данных с сервера</div>';
        }
    }

    // Создание карточек
    function createAnimeCards(list = animeList) {
        const grid = document.getElementById("animeGrid");
        grid.innerHTML = "";

        if (!list || list.length === 0) {
            grid.innerHTML = '<div class="no-results">Ничего не найдено</div>';
            return;
        }

        list.forEach(anime => {
            const card = document.createElement("div");
            card.className = "anime-card";

            const animePageUrl = `/anime.html?id=${anime.id}`;

            card.innerHTML = `
            <img src="${anime.preview_image}"
                 alt="${anime.title}"
                 class="anime-preview"
                 onclick="navigateTo('${animePageUrl}')"
                 onerror="this.src='https://via.placeholder.com/300x400/0a1120/64ffda?text=Нет+превью'">

            <button class="anime-btn"
                    onclick="navigateTo('${animePageUrl}'); event.stopPropagation();"
                    style="height: 60px; display: flex; align-items: center; justify-content: center;">
                ${anime.title}
            </button>
        `;

            card.addEventListener("click", () => navigateTo(animePageUrl));

            grid.appendChild(card);
        });
    }


    // Переход
    function navigateTo(url) {
        window.location.href = url;
    }

    // Telegram
    function goToTelegram() {
        window.open('https://t.me/AniWatchRU', '_blank');
    }

    // Поиск
    function searchAnime() {
        const term = document.getElementById("searchInput").value
            .toLowerCase()
            .trim();

        if (!term) {
            createAnimeCards();
            return;
        }

        const filtered = animeList.filter(a =>
            a.title.toLowerCase().includes(term)
        );

        createAnimeCards(filtered);
    }

    // Инициализация
    document.addEventListener("DOMContentLoaded", () => {
        loadAnime();

        document.getElementById("searchBtn").addEventListener("click", searchAnime);
        document.getElementById("searchInput").addEventListener("keyup", ev => {
            if (ev.key === "Enter") searchAnime();
        });

        document.getElementById("telegramBtn").addEventListener("click", goToTelegram);
    });
</script>

</body>
</html>
